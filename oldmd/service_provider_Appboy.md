
## Appboy

Appboy is a marketing automation platform for mobile apps with app analytics, segmentation, newsfeed, push, in-app messaging, email marketing, and user feedback feature sets. 

Appboy offers a broad range of functionality via their solution and it is critically important that you work directly with your Appboy representative to ensure that you are correctly planning and implementing their features.  mParticle does not recommend enabling forwarding to Appboy until you have completed the Appboy planning process with your Appboy team.

* [AppBoy Documentation](https://documentation.appboy.com/)

### mParticle Appboy Implementation Scenarios

**The mParticle SDK** allows you to include the Appboy kit which allows Appboy interface components (images, layout files, etc.) and as a result supports *the entire* Appboy feature set, which includes:

* App Analytics
* User Segmentation
* Push Notifications
* Email
* News Feed
* In-App Messaging
* Feedback

<aside>No features are supported by the standard mParticle SDK, alone. You must install mParticle's Appboy Kit to be able to forward data from your app to Appboy.</aside>

**The mParticle S2S API** allows you to send data server side ([API reference](/#http)). In this scenario, mParticle forwards data via Appboy's REST API which supports a limited set of features:

* App Analytics
* User Segmentation
* Push Notifications
* Email

#### Implementing for Full Appboy Feature Support

The Appboy solution offers features that involve Appboy-proprietary user interaction components including Newsfeed, In-App Messaging, and Feedback.  In order to properly incorporate Appboy with the mParticle SDK, please review the [Kits](#kits) section of the mParticle SDK Guide.  To enable Newsfeed, In-App Messaging, and Feedback features you will need to [call the Appboy embedded kit directly](#making-direct-calls-to-kits).

##### Special Considerations for mParticle A/B Testing With Appboy and the mParticle SDK

mParticle supports the ability to conduct A/B testing with different integrations by sending a sample of users and their data to one integration and a different sample of users and their data to a different integration.  If you are using the mParticle SDK for Appboy deployment *and* calling Appboy methods directly, when instrumenting with the mParticle SDK [you must ensure that the Appboy kit is active in the App before calling an Appboy method](#kit-availability-and-unavailability-notifications).  This is very important and ensures that you are not inadvertently calling Appboy methods for apps/users that are not part of an Appboy A/B sample.

### Data Processing Notes

mParticle will always forward events if sent via the mParticle SDK, provided you have included the Appboy kit, but will only forward events sent via the mParticle S2S API if the following conditions apply:

1. The App Group Identifier setting is specified
2. Either a CustomerId or a push token is specified
3. Appboy has limits on the number of characters in a property key - they must be less than or equal to 255 characters, with no leading dollar signs.  mParticle will remove the dollar sign ($) when forwarding property keys for user attributes, custom and e-commerce events.  [https://documentation.appboy.com/REST_API/#properties-object](https://documentation.appboy.com/REST_API/#properties-object)

### Prerequisites 

In order to activate the Appboy integration, you will need your Appboy API key and your "App Group Identifier" if using the S2S API.

1.  Sign into your AppBoy Account at [https://dashboard.appboy.com/developers/sign_in](https://dashboard.appboy.com/developers/sign_in)
2.  Click on App Settings in the left navigation to get your API Key
3.  If you are sending data to mParticle via the S2S API, your "App Group Identifier" value is required.  Click on the Developer Console in the left navigation to get this value.

![AppBoy Settings](AppGroupIdentifier.PNG)

### Event Data Mapping

#### Purchases

All events enabled for LTV tracking will forwarded as purchase events to Appboy, if the following event attributes are defined:

* `transactionId`
* `unitPrice`

Please note that this includes events generated by calls to `logTransaction`, with the MPProduct attributes `transactionId` and `unitPrice` defined.  We also pass the `currencyCode` attribute of the corresponding `MPProduct` object, or assume that the currency is USD if it's not defined.  

If `productQuantity` is greater than 1, we will forward Appboy a purchase event for each individual unit of the product (i.e. we'll send two identical purchase events if `productQuantity` equals 2).

#### Screen Views

Your screen view events will be passed to Appboy using the screen name that you passed to our `logScreen` SDK method, as the event name.  

If you are using automatic screen tracking in our Android SDK, the automatically-generated screen view events will be forwarded to Appboy using the name of the associated Activity class.

#### Custom Events

All custom events will be forwarded to Appboy using the event name that you passed to your `logEvent` SDK method.  All event attributes will be forwarded to Appboy as Appboy custom event properties using the attribute names you passed to your `logEvent` SDK method as well.

### User Attributes

The table below describes how the mParticle integration maps user attributes to Appboy's profile attributes.

mParticle Field |Appboy Profile Attribute | Description
|-
User Identity of type `CustomerId` |`external_id` |
User Attribute `$FirstName` |`first_name` |
User Attribute `$LastName` |`last_name` |
User Identity of type `Email` |`email` | 
Derived from User Attribute `$Age`) |`dob` | mParticle estimates the user's date of birth by subtracting `$Age` from the current year, and using January 1st as the month and day.  For example, if `$Age` is 10 and the current year is 2014, we'll forward the user's date of birth as 2004-01-01. If an exact birth date is desired, set a user attribute called `dob` with user's birth date. When both `$Age` and `dob` user attributes are sent, one value may override the other when mParticle forwards data to Appboy. So it is recommended that one of them is toggled **Off** in mParticle's data filter for Appboy.
User Attribute `$Country` |`country` |
User Attribute `$City` |`home_city` |
User Attribute `$Gender` |`gender` |
User Attribute `$Mobile` |`phone` | 
Derived from SDK opt-out status |`email_subscribe` |This is based on calling the `OptOut` (`setOptOut` in Android) SDK method .  It will be set to *opted_in* when called with a value of true and will be set to *unsubscribed* when called with a value of false.
 | `push_tokens` | Because Appboy can only accept a single push token for each app/user pair, we will forward the most recently-registered push token to Appboy per user and per app.
User Identity of type `Facebook` |`facebook` |
User Identity of type `Twitter` |`twitter` |
